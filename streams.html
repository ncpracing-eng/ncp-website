<style>
  /* === STREAM GRIDS 2er === */
  .streams-grid {
    display: grid;
    gap: 25px;
  }

  .live-grid,
  .offline-grid {
    grid-template-columns: repeat(2, 1fr); /* immer 2 Spalten */
  }

  @media (max-width: 800px) {
    .live-grid,
    .offline-grid {
      grid-template-columns: 1fr; /* auf kleinen Bildschirmen 1 Spalte */
    }
  }

  /* === OFFLINE STREAM === */
  .offline-box h4 {
    margin: 5px 0 0;
    font-size: 0.9em; /* echter Name kleiner */
    color: #ccc;
  }

  .offline-box .twitch-name {
    font-size: 1em;
    font-weight: 600;
    color: var(--ncp-accent);
    margin-bottom: 3px;
    display: block;
  }

  /* LIVE STREAM INFO */
  .stream-info h3 {
    font-size: 0.9em; /* echter Name kleiner */
    margin: 5px 0 0;
    color: #ccc;
  }

  .stream-info .twitch-name {
    font-size: 1em;
    font-weight: 600;
    color: var(--ncp-accent);
    margin-bottom: 3px;
    display: block;
  }

  /* Drag & Drop Styles */
  .streams-grid.dragging .stream-card {
    opacity: 0.5;
  }

  .stream-card.drag-over {
    border: 2px dashed var(--ncp-accent);
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script>
  const SHEET_ID = "1ZweNs9pfLIpNidgOMhtSfazjgHvt1o084sFR-zmX8Pw";
  const SHEET_NAME = "Streamer";
  const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

  fetch(SHEET_URL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;

      rows.slice(1).forEach(row => {
        const name = row.c[0]?.v || "";
        const twitchUser = row.c[1]?.v?.trim() || "";

        if (!twitchUser) return;

        const img = new Image();
        img.src = `https://static-cdn.jtvnw.net/previews-ttv/live_user_${twitchUser}-320x180.jpg`;

        img.onload = () => addStream(name, twitchUser, true);
        img.onerror = () => addStream(name, twitchUser, false);
      });

      // Drag & Drop initialisieren
      ["live-streams", "offline-streams"].forEach(id => {
        new Sortable(document.getElementById(id), {
          animation: 150,
          ghostClass: 'dragging',
          swap: true,        // Aktiviert direktes Tauschen der Kacheln
          swapClass: 'drag-over'
        });
      });
    })
    .catch(err => console.error("Fehler beim Laden der Stream-Daten:", err));

  function addStream(name, twitchUser, isLive) {
    const container = document.getElementById(isLive ? "live-streams" : "offline-streams");
    const card = document.createElement("div");
    card.classList.add("stream-card");

    if (!isLive) card.classList.add("offline");

    if (isLive) {
      card.innerHTML = `
        <div class="stream-video">
          <iframe
            src="https://player.twitch.tv/?channel=${twitchUser}&parent=${location.hostname}"
            allow="autoplay; fullscreen"
            frameborder="0">
          </iframe>
        </div>
        <div class="stream-info">
          <span class="twitch-name">@${twitchUser}</span>
          <h3>${name}</h3>
        </div>`;
    } else {
      card.innerHTML = `
        <a href="https://twitch.tv/${twitchUser}" target="_blank" class="offline-box">
          <img src="https://static-cdn.jtvnw.net/previews-ttv/live_user_${twitchUser}-320x180.jpg" alt="${name}">
          <div class="offline-overlay">Offline</div>
          <span class="twitch-name">@${twitchUser}</span>
          <h4>${name}</h4>
        </a>`;
    }

    container.appendChild(card);
  }
</script>
