<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Streams | Next Curve Performance</title>
<link rel="stylesheet" href="style.css" />
<style>
  body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    background: linear-gradient(180deg, #0a0a0a 0%, #101820 100%);
    color: #e0e0e0;
  }

  #header, #footer {
    width: 100%;
  }

  .page-header {
    text-align: center;
    padding: 50px 20px 30px;
    background: radial-gradient(circle at top, #0f2027, #203a43, #2c5364);
    color: white;
  }
  .page-header h2 { font-size: 2em; margin-bottom: 10px; }
  .page-header p { margin:0; }

  .streams-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    max-width: 900px;
    margin: 40px auto;
  }

  .stream-card {
    background: #111;
    border-radius: 12px;
    overflow: hidden;
    cursor: grab;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .stream-card:active { cursor: grabbing; }
  .stream-card:hover {
    transform: scale(1.03);
    box-shadow: 0 0 15px #00bcd4;
  }

  .stream-card img {
    width: 100%;
    display: block;
  }

  .stream-info {
    padding: 10px;
    text-align: center;
    background: #0e0e0e;
  }
  .stream-info .twitch-name {
    font-weight: 600;
    font-size: 1.1em;
    color: #00bcd4;
  }
  .stream-info .real-name {
    font-size: 0.9em;
    color: #ccc;
    margin-top: 2px;
  }
</style>
</head>
<body>

<div id="header"></div>

<section class="page-header">
  <h2>ðŸŽ¥ Streams</h2>
  <p>Alle Fahrer im Ãœberblick â€“ tausche die Kacheln nach deinem Geschmack!</p>
</section>

<section class="streams-section">
  <div id="streams-grid" class="streams-grid"></div>
</section>

<div id="footer"></div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
  // Header & Footer laden
  fetch("header.html").then(r => r.text()).then(t => document.getElementById("header").innerHTML = t);
  fetch("footer.html").then(r => r.text()).then(t => document.getElementById("footer").innerHTML = t);

  const SHEET_ID = "1ZweNs9pfLIpNidgOMhtSfazjgHvt1o084sFR-zmX8Pw";
  const SHEET_NAME = "Streamer";
  const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

  const grid = document.getElementById("streams-grid");
  const savedOrder = JSON.parse(localStorage.getItem("streamOrder") || "[]");

  // Google Sheet laden
  fetch(SHEET_URL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;

      const streamers = rows.slice(1).map(r => ({
        twitch: r.c[1]?.v?.trim() || "",
        name: r.c[0]?.v || ""
      })).filter(s => s.twitch);

      renderGrid(streamers);
    })
    .catch(err => console.error("Fehler beim Laden der Stream-Daten:", err));

  function renderGrid(streamers) {
    let ordered = streamers.slice();
    // Reihenfolge aus LocalStorage wiederherstellen
    if (savedOrder.length) {
      ordered.sort((a,b) => {
        const iA = savedOrder.indexOf(a.twitch);
        const iB = savedOrder.indexOf(b.twitch);
        if (iA === -1) return 1;
        if (iB === -1) return -1;
        return iA - iB;
      });
    }

    grid.innerHTML = "";
    ordered.forEach(s => {
      const card = document.createElement("div");
      card.classList.add("stream-card");
      card.dataset.user = s.twitch;
      card.innerHTML = `
        <img src="https://static-cdn.jtvnw.net/previews-ttv/live_user_${s.twitch}-320x180.jpg" alt="${s.name}">
        <div class="stream-info">
          <div class="twitch-name">${s.twitch}</div>
          <div class="real-name">${s.name}</div>
        </div>`;
      grid.appendChild(card);
    });

    // Drag & Drop aktivieren
    new Sortable(grid, {
      animation: 150,
      swap: true,
      swapClass: "highlight",
      onEnd: () => {
        const order = Array.from(grid.querySelectorAll(".stream-card")).map(c => c.dataset.user);
        localStorage.setItem("streamOrder", JSON.stringify(order));
      }
    });
  }
</script>
</body>
</html>
